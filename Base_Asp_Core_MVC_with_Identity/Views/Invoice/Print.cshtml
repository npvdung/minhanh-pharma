@using Base_Asp_Core_MVC_with_Identity.Models.View
@model InvoiceViewModel

@{
    Layout = null; // Để PDF không dính layout chung

    // Tách tên + SĐT từ field CustomerId = "Tên||SĐT"
    var customerDisplay = Model.Sales.CustomerId ?? "";
    var customerName = customerDisplay;
    var customerPhone = "";
    var parts = customerDisplay.Split("||");
    if (parts.Length > 0) { customerName = parts[0]; }
    if (parts.Length > 1) { customerPhone = parts[1]; }
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>@Model.Sales.InvoiceCode</title>
    <style>
        body { font-family: DejaVu Sans, Arial, Helvetica, sans-serif; font-size: 13px; }
        h2, h3 { text-align: center; margin: 5px 0; }
        .section-title { font-weight: bold; margin-top: 15px; margin-bottom: 5px; }
        .info-table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
        .info-table td { padding: 4px 6px; vertical-align: top; }
        .info-label { font-weight: bold; width: 120px; }
        table.details { width: 100%; border-collapse: collapse; margin-top: 10px; }
        table.details th, table.details td {
            border: 1px solid #ccc;
            padding: 6px 8px;
            text-align: center;
        }
        table.details th { background: #f2f2f2; }
        .text-right { text-align: right; }
    </style>
</head>
<body>
    <h2>HÓA ĐƠN BÁN HÀNG</h2>
    <h3>@Model.Sales.InvoiceCode</h3>

    <div class="section-title">Thông tin hóa đơn</div>
    <table class="info-table">
        <tr>
            <td class="info-label">Số hóa đơn:</td>
            <td>@Model.Sales.InvoiceCode</td>
            <td class="info-label">Ngày lập hóa đơn:</td>
            <td>@Model.Sales.InvoiceDate?.ToString("dd/MM/yyyy HH:mm")</td>
        </tr>
        <tr>
            <td class="info-label">Khách hàng:</td>
            <td>@customerName</td>
            <td class="info-label">Số điện thoại:</td>
            <td>@customerPhone</td>
        </tr>
        <tr>
            <td class="info-label">Người bán:</td>
            <td>@Model.Sales.UserId</td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td class="info-label">Ghi chú:</td>
            <td colspan="3">@Model.Sales.Description</td>
        </tr>
        <tr>
            <td class="info-label">Tổng tiền:</td>
            <td colspan="3" class="text-right">
                @String.Format("{0:n0}", Model.Sales.TotalAmount) ₫
            </td>
        </tr>
    </table>

    <div class="section-title">Chi tiết sản phẩm</div>
    <table class="details">
        <thead>
            <tr>
                <th>STT</th>
                <th>Tên sản phẩm</th>
                <th>Mã lô</th>
                <th>Đơn vị</th>
                <th>Tỉ lệ</th>
                <th>Số lượng</th>
                <th>Giá bán</th>
                <th>Thành tiền</th>
            </tr>
        </thead>
        <tbody>
        @{
            var stt = 1;
        }
        @foreach (var item in Model.salesProductsDetails)
        {
            <tr>
                <td>@(stt++)</td>   @* Sửa lại để Razor hiểu đúng, không in "1++" *@
                <td>@item.ProductId</td>      @* tên + HSD *@
                <td>@item.ImportId</td>       @* MÃ LÔ *@
                <td>@item.UnitProductId</td>  @* tên đơn vị *@
                <td>@item.Description</td>    @* tỉ lệ *@
                <td>@item.Quantity</td>
                <td class="text-right">@String.Format("{0:n0}", item.Price)</td>
                <td class="text-right">@String.Format("{0:n0}", item.TotalAmount)</td>
            </tr>
        }
        </tbody>
    </table>
</body>
</html>
